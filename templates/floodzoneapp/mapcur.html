{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map Example</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" />
    <link href="/dist/tailwind.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/map.css' %}">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="map-container">
        <div id="map"></div>
        <div id="sidebar" class="sidebar">
            <div class="text-gray-100 text-xl">
                <div class="p-2.5 mt-1 flex items-center">
                    <i onclick="toggleSidebar()" class="bi bi-filter-left p-2 top-10 left-10 bg-blue-700 rounded-md"></i></i>
    
                </div>
                <div class="my-2 bg-gray-600 h-[1px]"></div>
            </div>
            <div class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-blue-600 text-white">
                <i class="bi bi-water"></i>
                <span class="text-[15px] ml-4 text-gray-200 font-bold">Map</span>
            </div>
            <div class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-blue-600 text-white">
                <i class="bi bi-sliders2"></i>
                <span class="text-[15px] ml-4 text-gray-200 font-bold">Filter</span>
            </div>
            <div class="my-4 bg-gray-600 h-[1px]"></div>
            <div class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-blue-600 text-white" onclick="dropdown()">
                <i class="bi bi-graph-up-arrow"></i>
                <div class="flex justify-between w-full items-center">
                    <span class="text-[15px] ml-4 text-gray-200 font-bold">Analysis</span>
                    <span class="text-sm rotate-180" id="arrow">
                        <i class="bi bi-chevron-down"></i>
                    </span>
                </div>
            </div>
            <div class="text-left text-sm mt-2 w-4/5 mx-auto text-gray-200 font-bold hidden" id="submenu">
                <h1 id="chart" class="cursor-pointer p-2 hover:bg-blue-600 rounded-md mt-1" onclick="toggleBarchart()">Chart</h1>
                <h1 class="cursor-pointer p-2 hover:bg-blue-600 rounded-md mt-1">Sentiment</h1>
                <h1 class="cursor-pointer p-2 hover:bg-blue-600 rounded-md mt-1">Current Posts</h1>
            </div>
            <div class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-blue-600 text-white">
                <i class="bi bi-box-arrow-in-right"></i>
                <span class="text-[15px] ml-4 text-gray-200 font-bold">Settings</span>
            </div>
        </div>

        <div id="chartModal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="toggleBarchart()">&times;</span>
                <canvas id="chart" width="400" height="400"></canvas>
            </div>
        </div>
        
        <span class="toggle-button text-white text-4xl" id="toggleButton" onclick="toggleSidebar()">
            <i class="bi bi-filter-left px-2 bg-gray-900 rounded-md"></i>
        </span>
        <div class="fixed-search-bar">
            <input type="text" id="searchInput" placeholder="Search" />
            <button id="searchButton"><i class="bi bi-search text-sm p-2"></i></button>
        </div>
    </div>
    <script>
        const LEAFLET_CONFIG = {
            DEFAULT_CENTER: [5.6037, -0.1870],
            DEFAULT_ZOOM: 13,
            TILES: [
                ['OpenStreetMap', 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }],
                ['Terrain Map', 'http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                }],
                ['Data Map', 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
                }],
                ['Google Map', 'https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}', {
                    attribution: '&copy; <a href="https://www.another-layer.org/copyright">Another Layer</a>'
                }]
            ]
        };

        const map = L.map('map', {
            zoomControl: false
        }).setView(LEAFLET_CONFIG.DEFAULT_CENTER, LEAFLET_CONFIG.DEFAULT_ZOOM);

        const baseLayers = {};
        LEAFLET_CONFIG.TILES.forEach(([name, url, options]) => {
            baseLayers[name] = L.tileLayer(url, options);
        });

        baseLayers['OpenStreetMap'].addTo(map);
        L.control.layers(baseLayers).addTo(map);
        L.control.zoom({ position: 'topright' }).addTo(map);

        function main_map_init(map, options) {
            $.getJSON("{% url 'tweet' %}", function(data) {
                L.geoJSON(data, {
                    pointToLayer: function(feature, latlng) {
                        return L.circleMarker(latlng, {
                            fillColor: 'teal',
                            color: '#537898',
                            weight: 1,
                            fillOpacity: 0.5
                        }).on({
                            mouseover: function(e) {
                                this.setStyle({ color: 'yellow' });
                            },
                            mouseout: function(e) {
                                this.setStyle({ color: '#537898' });
                            }
                        });
                    }
                }).addTo(map);
            });
        }

        main_map_init(map, {});
    </script>
    <script src="{% static 'js/map.js' %}"></script>
</body>
</html>
